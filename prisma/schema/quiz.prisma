model Quiz {
  id          Int            @id @default(autoincrement())
  title       String
  description String?
  lectureId   Int
  teacherId   Int
  maxAttempts Int?
  timeLimit   Int?
  orderIndex  Int
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  lecture     Lecture        @relation(fields: [lectureId], references: [id], onDelete: Cascade)
  teacher     Teacher        @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  questions   QuizQuestion[]
  attempts    QuizAttempt[]

  @@unique([lectureId, orderIndex])
}

model QuizQuestion {
  id           Int          @id @default(autoincrement())
  quizId       Int
  questionText String
  type         QuestionType
  orderIndex   Int
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  quiz    Quiz                 @relation(fields: [quizId], references: [id], onDelete: Cascade)
  options QuizQuestionOption[]
  answers QuizAnswer[]

  @@unique([quizId, orderIndex])
}

model QuizQuestionOption {
  id         Int     @id @default(autoincrement())
  questionId Int
  optionText String
  isCorrect  Boolean @default(false)

  question QuizQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)
  answers  QuizAnswer[]
}

model QuizAttempt {
  id          Int       @id @default(autoincrement())
  quizId      Int
  studentId   Int
  score       Decimal?  @db.Decimal(5, 2)
  totalScore  Decimal   @db.Decimal(5, 2)
  isCompleted Boolean   @default(false)
  startedAt   DateTime  @default(now())
  completedAt DateTime?

  quiz    Quiz         @relation(fields: [quizId], references: [id], onDelete: Cascade)
  student Student      @relation(fields: [studentId], references: [id], onDelete: Cascade)
  answers QuizAnswer[]
}

model QuizAnswer {
  id               Int                 @id @default(autoincrement())
  attemptId        Int
  questionId       Int
  selectedOptionId Int?
  isCorrect        Boolean?
  createdAt        DateTime            @default(now())
  attempt          QuizAttempt         @relation(fields: [attemptId], references: [id], onDelete: Cascade)
  question         QuizQuestion        @relation(fields: [questionId], references: [id], onDelete: Cascade)
  selectedOption   QuizQuestionOption? @relation(fields: [selectedOptionId], references: [id])

  @@unique([attemptId, questionId])
}

enum QuestionType {
  MULTIPLE_CHOICE
  TRUE_FALSE
}
