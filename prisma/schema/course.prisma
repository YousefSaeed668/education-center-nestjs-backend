model Course {
  id          Int        @id @default(autoincrement())
  courseName  String
  courseType  CourseType
  thumbnail   String
  price       Decimal    @db.Decimal(10, 2)
  teacherId   Int
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  gradeId     Int
  description String?

  courseFeatures String[]
  expiresAt      DateTime?
  Division       Division[]
  grade          Grade           @relation(fields: [gradeId], references: [id])
  teacher        Teacher         @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  CourseLecture  CourseLecture[]
  studentCourse  StudentCourse[]
  CartItem       CartItem[]
  Comment        Comment[]
  Review         Review[]
  subjectId      Int
  subject        Subject         @relation(fields: [subjectId], references: [id])
}

model CourseLecture {
  id         Int     @id @default(autoincrement())
  courseId   Int
  lectureId  Int
  orderIndex Int
  course     Course  @relation(fields: [courseId], references: [id])
  lecture    Lecture @relation(fields: [lectureId], references: [id])

  @@unique([courseId, lectureId])
}

model Lecture {
  id             Int              @id @default(autoincrement())
  lectureName    String
  gradeId        Int?
  createdAt      DateTime         @default(now())
  teacherId      Int
  updatedAt      DateTime         @updatedAt
  CourseLecture  CourseLecture[]
  Division       Division[]
  Grade          Grade?           @relation(fields: [gradeId], references: [id])
  teacher        Teacher          @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  LectureContent LectureContent[]
  Quiz           Quiz[]
}

model LectureContent {
  id                       Int                      @id @default(autoincrement())
  lectureId                Int
  contentType              ContentType
  contentKey               String
  duration                 Int?
  createdAt                DateTime                 @default(now())
  orderIndex               Int
  contentName              String
  lecture                  Lecture                  @relation(fields: [lectureId], references: [id], onDelete: Cascade)
  studentLectureProgresses StudentLectureProgress[]
}

model StudentCourse {
  id          Int       @id @default(autoincrement())
  studentId   Int
  courseId    Int
  purchasedAt DateTime  @default(now())
  expiresAt   DateTime?
  isActive    Boolean   @default(true)
  course      Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)
  student     Student   @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, courseId])
}

model StudentLectureProgress {
  id               Int       @id @default(autoincrement())
  studentId        Int
  lectureContentId Int
  isCompleted      Boolean   @default(false)
  completedAt      DateTime? 
  createdAt        DateTime  @default(now())

  student        Student        @relation(fields: [studentId], references: [id], onDelete: Cascade)
  lectureContent LectureContent @relation(fields: [lectureContentId], references: [id], onDelete: Cascade)

  @@unique([studentId, lectureContentId])
  @@index([studentId, isCompleted])
}

enum CourseType {
  حصة
  شهرى
  سنوى
}

enum ContentType {
  VIDEO
  FILE
}
